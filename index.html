<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>UEFIStarter: Synopsis</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">UEFIStarter
   </div>
   <div id="projectbrief">a simple UEFI framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Synopsis </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is a small C framework for UEFI development built on top of TianoCore EDK2.</p>
<p>This repository includes a Vagrantfile for setting up a virtual machine to develop and run UEFI applications. If you're familiar with Vagrant and have it set up already you can run your first UEFI applications in just a few minutes!</p>
<p>The sources are hosted on <a href="https://github.com/rinusser/UEFIStarter">GitHub</a>.</p>
<h1>General</h1>
<h3>What this IS NOT</h3>
<p>This project is not a comprehensive course in UEFI development. If you're just starting to write UEFI code you'll need to use additional material like the <a href="https://github.com/tianocore/tianocore.github.io/wiki/EDK-II-User-Documentation">official TianoCore documentation</a>, and the <a href="http://www.uefi.org/specifications">UEFI Specification</a>.</p>
<h3>What this IS</h3>
<p>The library and UEFI applications included in this code are meant to simplify a few repetitive tasks when developing UEFI code. For example there is a configurable command line argument parser that will validate input strings and convert them into the target datatype, e.g. integers.</p>
<p>This project started out with another UEFI development kit (gnu-efi) but eventually outgrew the original SDK, so I migrated it to TianoCore EDK2017. As a result of this there are still a few library functions included that are already built-in into TianoCore.</p>
<p>It is my hope that this code helps anyone looking into, or starting with, UEFI development: I did that myself a few months ago and found parts of the various documentations frustratingly lacking. If I can spare you some of the headache I had I'm happy.</p>
<h1>Requirements</h1>
<p>You can either set up your own development environment ("Manual Installation"), or use the supplied Vagrantfile to create a development VM ("Vagrant").</p>
<h2>Vagrant</h2>
<p>To use the included Vagrantfile you'll need:</p>
<ul>
<li>a 64-bit x86 processor (physical or virtual, see Recommendations below)</li>
<li>a UEFI-capable mainboard (physical or virtual, see Recommendations below)</li>
<li>Vagrant (tested with 2.0)</li>
<li>VirtualBox (tested with 5.1)</li>
</ul>
<h2>Manual Installation</h2>
<h3>Bare Minimum</h3>
<p>To set up your own development environment you'll need at least:</p>
<ul>
<li>a 64-bit x86 processor (physical or virtual, see Recommendations below)</li>
<li>a UEFI-capable mainboard (physical or virtual, see Recommendations below)</li>
<li>Linux (tested with Ubuntu 17.04) with sgdisk, mkisofs and mkdosfs installed (you'll need root access)</li>
<li>a working TianoCore EDK2017 development setup (earlier versions might be OK too) with GCC</li>
</ul>
<h3>Optional</h3>
<ul>
<li>Doxygen (if you want to generate the documentation), plus whatever you may need for your desired output format</li>
</ul>
<h3>Recommendations</h3>
<p>You can reboot into the UEFI applications if you want (and have the spare machine or don't mind rebooting all the time), but it's easier to use virtualization for development. There are multiple options:</p>
<ul>
<li>QEMU with OVMF - I use mostly this, except for running graphical applications. It's very fast to work with. The OVMF image adds EFI support to QEMU, you'll need to download and install it separately.</li>
<li>VirtualBox - has built-in EFI support. I use this to run the graphical UEFI applications: it easily outperforms QEMU, at least on my machines.</li>
<li>Other: you're probably fine with any hypervisor that supports EFI.</li>
</ul>
<p>If you <em>do</em> want to actually boot a machine into the custom UEFI environment a spare USB stick you don't mind formatting comes in handy.</p>
<h1>Installation</h1>
<p>The instructions on how to install the Vagrant virtual machine are in <a href="https://github.com/rinusser/UEFIStarter/blob/master/INSTALL.vagrant%2Emd">INSTALL.vagrant.md</a>.</p>
<p>If you prefer to set up your own development environment see <a href="https://github.com/rinusser/UEFIStarter/blob/master/INSTALL.manual%2Emd">INSTALL.manual.md</a>.</p>
<h1>Usage</h1>
<h3>Running</h3>
<p>If you're using QEMU you can start it with: </p><pre class="fragment">$ make run
</pre><p>Alternatively you can mount the .iso image UEFIStarter/target/UEFIStarter.iso in e.g. VirtualBox and boot from it.</p>
<p>Either way, the default startup.nsh script will run all test suites and return to the UEFI shell.</p>
<p>The root directory contains all built applications.</p>
<p>:warning: Contains AC'97 audio output that may be too loud, see <a class="el" href="apps_2ac97_8c.html" title="AC&#39;97 audio demo. ">apps/ac97.c</a> for details.</p>
<h3>Booting from USB</h3>
<p>You'll need a USB storage device formatted with FAT32 for this. A USB stick will do, an external hard drive works just as well. You can boot from any UEFI-capable 64-bit x86 system, as long as "Secure Boot" is disabled.</p>
<p>After successfully building UEFIStarter all you need to do is copy the ISO file's contents onto the USB device. If, for example, your USB device is mounted on /mnt/usb/, after copying there should be files/directories /mnt/usb/EFI, /mnt/usb/tests, /mnt/usb/.version and so on. On Windows it should be e.g. D:\EFI, D:\.version etc.</p>
<p>After copying the .iso's contents onto the USB device you can boot from it. This usually involves pressing a vendor-specific key or key combination at boot time to get to a boot device selection, like F2, Shift-F8, F12 etc.</p>
<h3>Working on UEFIStarter</h3>
<p>There is a semi-automatically generated documentation hosted on <a href="https://rinusser.github.io/UEFIStarter/">GitHub</a>. The functions, data types etc. are described on the <a href="https://rinusser.github.io/UEFIStarter/modules.html">Modules</a> page.</p>
<p>The documentation is still a work in progress.</p>
<p>Each shell you want to run the edk2 build process in needs to import <code>edksetup.sh</code> in the edk2 sources root: </p><pre class="fragment">$ . edksetup.sh
</pre><p>You only need to do this once per shell. The Makefile contains everything else you need to build the UEFIStarter package: </p><pre class="fragment">$ make
</pre><p>When this finishes successfully the UEFIStarter/target directory contains an .img file with a filesystem for QEMU, and an .iso image with the same contents for e.g. a VirtualBox virtual CD/DVD drive.</p>
<h3>Including UEFIStarter</h3>
<p>To make the UEFIStarter's package contents (e.g. library files) available to your own EDK2 project you'll need to register the libraries in your package's .dsc file and add the "UEFIStarter/UEFIStarter.dec" package dependency in e.g. your applications' .inf files.</p>
<p>If you want to start a new EDK2 project based on UEFIStarter from scratch you currently need to perform these steps:</p>
<ul>
<li>create a new project directory - either directly in your edk2 source root, or linked to from there</li>
<li>copy UEFIStarter.dec, UEFIStarter.dsc and Makefile.edk to your new project root</li>
<li>rename and edit UEFIStarter.* in your project: change the project names, paths and included libraries as necessary</li>
<li>edit Conf/target.txt (relative from your edk2 sources root) and change ACTIVE_PLATFORM to your new .dsc file</li>
<li>edit Makefile.edk and change the project name and paths</li>
<li>replace the Makefile link in your edk2 sources root with a new link to your project's</li>
<li>(if you want to use the test framework you'll currently need to copy it or change the reference paths in .c, .h and suite's .inf file; either way, you currently also need to change the paths in tools/*.sh)</li>
</ul>
<p>These steps will be simplified and automated later. If you're unfamiliar with EDK2 it's easier to just make changes to your local copy of UEFIStarter for now, e.g. in a new git branch.</p>
<p>There's already a separate project (a game, actually) using this framework but it hasn't been published yet. Once that's done its code will demonstrate how to include UEFIStarter in other edk2 packages.</p>
<h1>Tests</h1>
<p>This project contains a test framework for writing tests. There are test suites for validating the framework functions and the test framework itself. The tests are executed in the UEFI shell - there is a script to run all test suites: </p><pre class="fragment">FS0:\&gt; cd tests
FS0:\tests\&gt; run
</pre><p>Test suites are individual .efi executables that can be run individually, e.g.: </p><pre class="fragment">FS0:\tests\&gt; testlib -verbosity 1
.............
Result: SUCCESS

Successful tests: 13
Failed tests:     0
Incomplete tests: 0
Skipped groups:   0
</pre><p>The <code>testself</code> suite contains a "runner" test group that fails on purpose, the <code>run.nsh</code> script skips this.</p>
<p>The test suites support command line parameters, for example you can skip test groups or change the output verbosity. You can get a full list of parameters with "-help".</p>
<h1>Legal</h1>
<h3>Copyright</h3>
<p>Copyright (C) 2017-2018 Richard Nusser</p>
<h3>License</h3>
<p>This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.</p>
<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License along with this program. If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.</p>
<h3>Credits</h3>
<p>Contains an excerpt from <a href="http://pci-ids.ucw.cz/">The PCI ID Repository</a>, licensed under GPLv3.</p>
<p>Contains an optional automated installer, a "Vagrantfile". By using this installer you additionally agree to the licenses of all installed components, see the respective websites for details:</p><ul>
<li>Ubuntu: <a href="https://www.ubuntu.com/about/about-ubuntu/licensing">https://www.ubuntu.com/about/about-ubuntu/licensing</a></li>
<li>TianoCore: <a href="https://github.com/tianocore/tianocore.github.io/wiki/Legalese">https://github.com/tianocore/tianocore.github.io/wiki/Legalese</a> </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jan 22 2018 21:12:24 for UEFIStarter by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
